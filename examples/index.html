<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    
    <title>Toubkal - Examples</title>
    
    <!-- Bootstrap version 3.3.4 CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic|Oswald&subset=latin,latin-ext"/>
    <link href="css/base.css"  type="text/css" rel="stylesheet" /> <!-- base css style for all web pages -->
    
    <script src="/socket.io/socket.io.js"></script>
    
    <script src="/lib/toubkal-min.js"></script>
  </head>
  
  <body>
    <h3>Toubkal Examples</h3>
    
    <ul id="examples">
      <li id="to_dom-1-2">
        <a id="to_dom-2-2">to_dom-2-2</a>
      </li>
    </ul>
    
    <script>
      rs.socket_io_server()
        .Singleton( '$examples', function( source, options ) {
          return source
            .trace( 'examples' )
            .$query_selector( '#examples' )
          ;
        } )
        
        .flow( 'examples', { key: [ 'id' ] } )
        
        //.order( [ { id: 'id', descending: true } ] )
        
        //.trace( 'before examples' )
        
        .$to_dom( rs.$examples() )
        
        .trace( 'after examples' )
        
        .alter( function( v ) {
          v.tag = 'a';
          v.content = v.title;
          v.attributes = rs.RS.extend( { href: v.path }, v.attributes );
        } )
        
        //.trace( 'before a' )
        
        .set_output( 'a' )
      ;
      
      rs.once( 1000 )
        .alter( function( v ) {
          rs.output( 'a' )
            .$to_dom()
            //.trace( 'after a' )
            .greedy()
          ;
        } )
      ;
      
      var beat = 20000;
      
      rs.beat( beat )
        //.once( 0 )
        .$examples()
      ;
      
      rs.once( beat - 2000 )
        .map( function( v ) { return { interval: beat } } )
        .beat()
        .revert()
        .$examples()
      ;
      
      rs.socket_io_server()
        .flow( 'assets' )
        .alter( function( asset ) {
          window.location.reload()
        } )
      ;
    </script>
  </body>
</html>
