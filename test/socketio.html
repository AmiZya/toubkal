<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <link rel="stylesheet" href="css/mocha.css" />
    
    <title>XS Tests</title>
    
    <script src="../lib/xs-min.js"></script>
    
    <script src="/socket.io/socket.io.js"></script>
    
  </head>
  
  <body>
    <div id="socketio_test"></div>
    
    <script>
      window.onload = function() {
        var log = XS.log, de = true, ug = function( m ) {
          log( 'socketio tests, ' + m )
        }
        
        var u, socket, connection = {};
        
        var address = location.protocol + '//' + location.host;
        
        de&&ug( 'connecting to ' + address );
        
        socket = io.connect( address )
          .on( 'connect', function() {
            de&&ug( 'received connect' );
            
            connection.state = 'requesting_id'
            
            socket.emit( 'xs_connection', connection );
          } )
          
          .on( 'disconnect', function() {
            de&&ug( 'received disconnect' );
            
            connection.state = 'disconnected';
          } )
          
          .on( 'reconnect', function() {
            de&&ug( 'received reconnect' );
          } )
          
          .on( 'xs_connection', function( _connection ) {
            de&&ug( 'received xs_connection: ' + log.s( _connection ) );
            
            connection = _connection;
            
            connection.state = 'connected';
            
            // send some operation
            socket.emit( 'xs_add', { values: [ { id: 1 } ] } )
          } )
        
          .on( 'xs', function ( data ) {
            de&&ug( 'received data: ' + log.s( data ) );
          } )
        ;
      };
    </script>
  </body>
</html>
